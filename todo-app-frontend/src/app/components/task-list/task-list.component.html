<h2>Task List</h2>

<button [routerLink]="['/tasks/add']" class="add-task-btn">New Task</button>

<ul *ngIf="tasks.length; else noTasks">
  <div *ngFor="let task of tasks" class="task-item">
    <!-- Task Header -->
    <div class="task-header">
      <div class="task-title">
        <input
          type="checkbox"
          [checked]="task.status === 'completed'"
          (change)="onCompleteTask(task.id, $event)"
        />
        <span [class.completed]="task.status === 'completed'">{{ task.title }}</span>
      </div>
      <button
        *ngIf="task.subtasks?.length"
        (click)="toggleDetails(task)"
        class="toggle-btn"
      >
        {{ task.showDetails ? 'Hide Subtasks ▲' : 'Show Subtasks ▼' }}
      </button>
    </div>

    <p *ngIf="task.description">{{ task.description }}</p>

    <!-- Subtasks Section -->
    <div [class.subtasks-container]="true" [class.show]="task.showDetails">
      <h4 *ngIf="task.subtasks?.length">Subtasks</h4>
      <ul *ngIf="task.subtasks?.length">
        <li *ngFor="let subtask of task.subtasks" class="subtask-item">
          <input
            type="checkbox"
            [checked]="subtask.status === 'completed'"
            (change)="completeSubtask(task.id, subtask.id, $event)"
          />
          <span [class.completed]="subtask.status === 'completed'">{{ subtask.title }}</span>
          <button (click)="deleteSubtask(task.id, subtask.id)">Delete Subtask</button>
        </li>
      </ul>
    </div>

    <!-- Add New Subtask -->
    <input
      type="text"
      placeholder="New subtask title"
      [(ngModel)]="newSubtaskTitle[task.id]"
    />
    <button (click)="addSubtask(task.id)">Add Subtask</button>

    <!-- Task Action Buttons -->
    <div class="task-actions">
      <button (click)="deleteTask(task.id)">Delete Task</button>
      <button [routerLink]="['/tasks/edit', task.id]">Edit Task</button>
    </div>
    <hr />
  </div>
</ul>

<ng-template #noTasks>
  <p>No tasks found.</p>
</ng-template>
